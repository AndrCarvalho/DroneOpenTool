import pyproj

geodesic = pyproj.Geod(ellps='WGS84') #notice: [lon lat] notation!!!


def smooth_path(path):
    new_path = []
    new_path.append(path[0])
    for i in range(0, len(path)-1, 2):

        if i + 2 >= len(path):
            continue

        fw_az1, bck_az1, dist1 = geodesic.inv(path[i][1], path[i][0], path[i + 1][1], path[i + 1][0])
        fw_az2, bck_az2, dist2 = geodesic.inv(path[i + 1][1], path[i + 1][0], path[i + 2][1], path[i + 2][0])

        '''
        fw_az1, bck_az1, dist1 = geodesic.inv(path[i][0], path[i][1],
                                              path[i + 1][0], path[i + 1][1])  ## modified test version = (...[0], ...[1])
        fw_az2, bck_az2, dist2 = geodesic.inv(path[i + 1][0], path[i + 1][1],
                                              path[i + 2][0], path[i + 2][1])  ## modified test version = (...[0], ...[1])
        '''

        if abs(fw_az2 - fw_az1) >= 5:
            new_path.append(path[i + 1])
        new_path.append(path[i + 2])

    if path[len(path)-1] not in new_path:
        new_path.append(path[len(path)-1])

    #print("smooth:", new_path)
    return new_path

def optimize_path(path):
    initial_path = path
    check = False
    while not check:
        old_path = path
        path = smooth_path(path)

        if path == old_path:
            check = True
    print("Initial path:",len(initial_path)," | Smooth path:",len(path))
    print("Difference path smoothing:", len(initial_path) - len(path))
    return path
'''
##Testing
path_1 = [[-9.12673, 38.73027], [-9.126754, 38.730283], [-9.126778, 38.730296], [-9.126802, 38.730309], [-9.126826, 38.730322], [-9.12685, 38.730335], [-9.126874, 38.730348], [-9.126898, 38.730361], [-9.126922, 38.730374], [-9.126946, 38.730387], [-9.12697, 38.7304], [-9.126995, 38.730413], [-9.127019, 38.730426], [-9.127043, 38.730439], [-9.127067, 38.730452], [-9.127091, 38.730465], [-9.127115, 38.730478], [-9.127139, 38.730491], [-9.127163, 38.730504], [-9.127187, 38.730518], [-9.127211, 38.730531], [-9.127235, 38.730544], [-9.127259, 38.730557], [-9.127283, 38.73057], [-9.127307, 38.730583], [-9.127331, 38.730596], [-9.127355, 38.730609], [-9.127379, 38.730622], [-9.127403, 38.730635], [-9.127427, 38.730648], [-9.127451, 38.730661], [-9.127475, 38.730674], [-9.127499, 38.730687], [-9.127524, 38.7307], [-9.127548, 38.730713], [-9.127572, 38.730726], [-9.127596, 38.730739], [-9.12762, 38.730752], [-9.127644, 38.730765], [-9.127668, 38.730778], [-9.127692, 38.730791], [-9.127716, 38.730804], [-9.12774, 38.730817], [-9.127764, 38.73083], [-9.127788, 38.730843], [-9.127812, 38.730856], [-9.127836, 38.730869], [-9.12786, 38.730882], [-9.127884, 38.730895], [-9.127908, 38.730908], [-9.127932, 38.730921], [-9.127956, 38.730934], [-9.12798, 38.730947], [-9.128004, 38.73096], [-9.128028, 38.730973], [-9.128053, 38.730986], [-9.12806, 38.731018], [-9.128043, 38.731037], [-9.128027, 38.731056], [-9.12801, 38.731075], [-9.127994, 38.731094], [-9.127977, 38.731112], [-9.12796, 38.731131], [-9.127968, 38.731163], [-9.127951, 38.731182], [-9.127935, 38.731201], [-9.127918, 38.731219], [-9.127901, 38.731238], [-9.127909, 38.73127], [-9.127892, 38.731289], [-9.127876, 38.731308], [-9.127859, 38.731326], [-9.127843, 38.731345], [-9.12785, 38.731377], [-9.127833, 38.731396], [-9.127817, 38.731415], [-9.1278, 38.731433], [-9.127784, 38.731452], [-9.127791, 38.731484], [-9.127774, 38.731503], [-9.127758, 38.731522], [-9.127741, 38.73154], [-9.127725, 38.731559], [-9.127732, 38.731591], [-9.127715, 38.73161], [-9.127699, 38.731629], [-9.127706, 38.73166], [-9.127714, 38.731692], [-9.127721, 38.731724], [-9.127745, 38.731737], [-9.127769, 38.73175], [-9.127793, 38.731763], [-9.127817, 38.731776], [-9.127841, 38.731789], [-9.127865, 38.731802], [-9.12789, 38.731815], [-9.127914, 38.731828], [-9.127938, 38.731841], [-9.127962, 38.731854], [-9.127986, 38.731867], [-9.12801, 38.73188], [-9.128034, 38.731893], [-9.128074, 38.731888], [-9.128099, 38.731901], [-9.128123, 38.731914], [-9.128147, 38.731927], [-9.128171, 38.73194], [-9.128195, 38.731953], [-9.128219, 38.731966], [-9.128243, 38.731979], [-9.128267, 38.731992], [-9.128291, 38.732005], [-9.128315, 38.732018], [-9.128339, 38.732031], [-9.128363, 38.732044], [-9.128404, 38.732038], [-9.128428, 38.732051], [-9.128452, 38.732064], [-9.128476, 38.732077], [-9.1285, 38.73209], [-9.128524, 38.732103], [-9.128548, 38.732116], [-9.128572, 38.732129], [-9.128596, 38.732142], [-9.12862, 38.732155], [-9.128644, 38.732168], [-9.128668, 38.732181], [-9.128692, 38.732195], [-9.128733, 38.732189], [-9.128757, 38.732202], [-9.128781, 38.732215], [-9.128805, 38.732228], [-9.128846, 38.732222], [-9.12887, 38.732235], [-9.128894, 38.732248], [-9.128918, 38.732261], [-9.128942, 38.732274], [-9.128982, 38.732268], [-9.129023, 38.732263], [-9.129047, 38.732276], [-9.129071, 38.732289], [-9.129095, 38.732302], [-9.129119, 38.732315], [-9.129143, 38.732328], [-9.129167, 38.732341], [-9.129208, 38.732335], [-9.129232, 38.732348], [-9.129256, 38.732361], [-9.12928, 38.732374], [-9.129321, 38.732368], [-9.129345, 38.732381], [-9.129369, 38.732394], [-9.12941, 38.732389], [-9.129434, 38.732402], [-9.129458, 38.732415], [-9.129498, 38.732409], [-9.129522, 38.732422], [-9.129546, 38.732435], [-9.12957, 38.732448], [-9.129611, 38.732442], [-9.129635, 38.732455], [-9.129659, 38.732468], [-9.1297, 38.732462], [-9.129724, 38.732475], [-9.129748, 38.732489], [-9.129789, 38.732483], [-9.129813, 38.732496], [-9.129837, 38.732509], [-9.129861, 38.732522], [-9.129901, 38.732516], [-9.129925, 38.732529], [-9.129949, 38.732542], [-9.12999, 38.732536], [-9.130014, 38.732549], [-9.130038, 38.732562], [-9.130079, 38.732557], [-9.130103, 38.73257], [-9.130127, 38.732583], [-9.130151, 38.732596], [-9.130192, 38.73259], [-9.130216, 38.732603], [-9.13024, 38.732616], [-9.13028, 38.73261], [-9.130304, 38.732623], [-9.130328, 38.732636], [-9.130369, 38.73263], [-9.130393, 38.732644], [-9.130417, 38.732657], [-9.130441, 38.73267], [-9.130465, 38.732683], [-9.130489, 38.732696], [-9.130513, 38.732709], [-9.130537, 38.732722], [-9.130562, 38.732735], [-9.130586, 38.732748], [-9.130626, 38.732742], [-9.13065, 38.732755], [-9.130674, 38.732768], [-9.130698, 38.732781], [-9.130739, 38.732775], [-9.130763, 38.732788], [-9.130787, 38.732801], [-9.130811, 38.732814], [-9.130835, 38.732827], [-9.130859, 38.73284], [-9.130883, 38.732853], [-9.130907, 38.732866], [-9.130931, 38.732879], [-9.130955, 38.732893], [-9.130979, 38.732906], [-9.13102, 38.7329], [-9.131037, 38.732881], [-9.131077, 38.732875], [-9.131118, 38.732869], [-9.131142, 38.732882], [-9.131166, 38.732895], [-9.131207, 38.73289], [-9.131231, 38.732903], [-9.131255, 38.732916], [-9.131279, 38.732929], [-9.13132, 38.732923], [-9.131344, 38.732936], [-9.131368, 38.732949], [-9.131408, 38.732943], [-9.131432, 38.732956], [-9.131456, 38.732969], [-9.131497, 38.732964], [-9.131521, 38.732977], [-9.131545, 38.73299], [-9.131586, 38.732984], [-9.13161, 38.732997], [-9.131634, 38.73301], [-9.131658, 38.733023], [-9.131682, 38.733036], [-9.131706, 38.733049], [-9.13173, 38.733062], [-9.131771, 38.733056], [-9.131795, 38.733069], [-9.131835, 38.733063], [-9.131859, 38.733077], [-9.131883, 38.73309], [-9.131924, 38.733084], [-9.131948, 38.733097], [-9.131972, 38.73311], [-9.132013, 38.733104], [-9.132037, 38.733117], [-9.132061, 38.73313], [-9.132102, 38.733124], [-9.132126, 38.733137], [-9.13215, 38.73315], [-9.132174, 38.733163], [-9.132214, 38.733158], [-9.132238, 38.733171], [-9.132262, 38.733184], [-9.132303, 38.733178], [-9.132327, 38.733191], [-9.132351, 38.733204], [-9.132392, 38.733198], [-9.132416, 38.733211], [-9.13244, 38.733224], [-9.132464, 38.733237], [-9.132505, 38.733232], [-9.132529, 38.733245], [-9.132553, 38.733258], [-9.132593, 38.733252], [-9.132617, 38.733265], [-9.132642, 38.733278], [-9.132682, 38.733272], [-9.132706, 38.733285], [-9.13273, 38.733298], [-9.132771, 38.733292], [-9.132795, 38.733305], [-9.132819, 38.733318], [-9.132843, 38.733331], [-9.132884, 38.733326], [-9.132908, 38.733339], [-9.132932, 38.733352], [-9.132972, 38.733346], [-9.132996, 38.733359], [-9.133021, 38.733372], [-9.133061, 38.733366], [-9.133085, 38.733379], [-9.133109, 38.733392], [-9.133133, 38.733405], [-9.133174, 38.7334], [-9.133198, 38.733413], [-9.133222, 38.733426], [-9.133246, 38.733439], [-9.13327, 38.733452], [-9.133294, 38.733465], [-9.133318, 38.733478], [-9.133342, 38.733491], [-9.133383, 38.733485], [-9.133424, 38.733479], [-9.133464, 38.733473], [-9.133488, 38.733486], [-9.133512, 38.733499], [-9.133553, 38.733494], [-9.133577, 38.733507], [-9.133601, 38.73352], [-9.133642, 38.733514], [-9.133666, 38.733527], [-9.13369, 38.73354], [-9.13373, 38.733534], [-9.133755, 38.733547], [-9.133779, 38.73356], [-9.133803, 38.733573], [-9.133827, 38.733586], [-9.133851, 38.733599], [-9.133875, 38.733612], [-9.133882, 38.733644], [-9.13389, 38.733676], [-9.133897, 38.733708], [-9.133905, 38.73374], [-9.133912, 38.733772], [-9.133936, 38.733785], [-9.133944, 38.733816], [-9.133968, 38.733829], [-9.133992, 38.733842], [-9.134016, 38.733855], [-9.13404, 38.733868], [-9.134064, 38.733881], [-9.134088, 38.733895], [-9.134095, 38.733926], [-9.134119, 38.733939], [-9.134127, 38.733971], [-9.134134, 38.734003], [-9.134142, 38.734035], [-9.134149, 38.734067], [-9.134173, 38.73408], [-9.134197, 38.734093], [-9.134221, 38.734106], [-9.134245, 38.734119], [-9.134269, 38.734132], [-9.134293, 38.734145], [-9.134317, 38.734158], [-9.134341, 38.734171], [-9.134366, 38.734184], [-9.13439, 38.734197], [-9.13443, 38.734191], [-9.134471, 38.734185], [-9.134512, 38.73418], [-9.134552, 38.734174], [-9.134569, 38.734155], [-9.134585, 38.734136], [-9.134602, 38.734117], [-9.134619, 38.734099], [-9.134635, 38.73408], [-9.134652, 38.734061], [-9.134668, 38.734042], [-9.134685, 38.734023], [-9.134702, 38.734005], [-9.134718, 38.733986], [-9.134735, 38.733967], [-9.134751, 38.733948], [-9.134768, 38.733929], [-9.134809, 38.733924], [-9.134833, 38.733937], [-9.134857, 38.73395], [-9.134881, 38.733963], [-9.134905, 38.733976], [-9.134929, 38.733989], [-9.134953, 38.734002], [-9.13496, 38.734034], [-9.134968, 38.734065], [-9.135008, 38.73406], [-9.135033, 38.734073], [-9.135057, 38.734086], [-9.135081, 38.734099], [-9.135121, 38.734093], [-9.135145, 38.734106], [-9.135186, 38.7341], [-9.135227, 38.734095], [-9.135267, 38.734089], [-9.135284, 38.73407], [-9.1353, 38.734051], [-9.135317, 38.734032], [-9.135334, 38.734014], [-9.13535, 38.733995], [-9.135367, 38.733976], [-9.135407, 38.73397], [-9.135432, 38.733983], [-9.135456, 38.733996], [-9.13548, 38.734009], [-9.135504, 38.734022], [-9.135544, 38.734017], [-9.135568, 38.73403], [-9.135592, 38.734043], [-9.135616, 38.734056], [-9.135641, 38.734069], [-9.135665, 38.734082], [-9.135689, 38.734095], [-9.135729, 38.734089], [-9.135753, 38.734102], [-9.135777, 38.734115], [-9.135801, 38.734128], [-9.135825, 38.734141], [-9.13585, 38.734154], [-9.13589, 38.734148], [-9.135914, 38.734161], [-9.135938, 38.734174], [-9.135962, 38.734187], [-9.135986, 38.7342], [-9.136027, 38.734195], [-9.136051, 38.734208], [-9.136075, 38.734221], [-9.136099, 38.734234], [-9.136123, 38.734247], [-9.136131, 38.734279], [-9.136155, 38.734292], [-9.136195, 38.734286], [-9.136219, 38.734299], [-9.13626, 38.734293], [-9.136284, 38.734306], [-9.136308, 38.734319], [-9.136332, 38.734332], [-9.136356, 38.734345], [-9.13638, 38.734358], [-9.136421, 38.734352], [-9.136445, 38.734365], [-9.136469, 38.734378], [-9.136493, 38.734391], [-9.136517, 38.734404], [-9.136541, 38.734417], [-9.136565, 38.734431], [-9.136589, 38.734444], [-9.13663, 38.734438], [-9.136654, 38.734451], [-9.136678, 38.734464], [-9.136702, 38.734477], [-9.136726, 38.73449], [-9.13675, 38.734503], [-9.136774, 38.734516], [-9.136798, 38.734529], [-9.136822, 38.734542], [-9.13683, 38.734574], [-9.136837, 38.734606], [-9.136845, 38.734637], [-9.136852, 38.734669], [-9.13686, 38.734701], [-9.136867, 38.734733], [-9.136874, 38.734765], [-9.136882, 38.734797], [-9.136889, 38.734828], [-9.136897, 38.73486], [-9.136904, 38.734892], [-9.136912, 38.734924], [-9.136952, 38.734918], [-9.136993, 38.734912], [-9.137034, 38.734907], [-9.137074, 38.734901], [-9.137098, 38.734914], [-9.137139, 38.734908], [-9.13718, 38.734902], [-9.13722, 38.734896], [-9.137261, 38.734891], [-9.137302, 38.734885], [-9.137326, 38.734898], [-9.137366, 38.734892], [-9.137407, 38.734886], [-9.137448, 38.734881], [-9.137488, 38.734875], [-9.137529, 38.734869], [-9.13757, 38.734863], [-9.13761, 38.734858], [-9.137651, 38.734852], [-9.137692, 38.734846], [-9.137732, 38.73484], [-9.137773, 38.734834], [-9.137813, 38.734829], [-9.137854, 38.734823], [-9.137895, 38.734817], [-9.137935, 38.734811], [-9.137976, 38.734806], [-9.138017, 38.7348], [-9.138041, 38.734813], [-9.138081, 38.734807], [-9.138122, 38.734801], [-9.138163, 38.734796], [-9.138203, 38.73479], [-9.138244, 38.734784], [-9.138285, 38.734778], [-9.138325, 38.734772], [-9.138366, 38.734767], [-9.138407, 38.734761], [-9.138447, 38.734755], [-9.138488, 38.734749], [-9.138529, 38.734744], [-9.138569, 38.734738], [-9.13861, 38.734732], [-9.13865, 38.734726], [-9.138691, 38.73472], [-9.138732, 38.734715], [-9.138756, 38.734728], [-9.138796, 38.734722], [-9.138837, 38.734716], [-9.138878, 38.73471], [-9.138918, 38.734705], [-9.138959, 38.734699], [-9.139, 38.734693], [-9.13904, 38.734687], [-9.139081, 38.734682], [-9.139122, 38.734676], [-9.139146, 38.734689], [-9.13917, 38.734702], [-9.139194, 38.734715], [-9.139218, 38.734728], [-9.139242, 38.734741], [-9.139266, 38.734754], [-9.13929, 38.734767], [-9.139314, 38.73478], [-9.139338, 38.734793], [-9.139362, 38.734806], [-9.139386, 38.734819], [-9.139427, 38.734813], [-9.139451, 38.734826], [-9.139475, 38.734839], [-9.139499, 38.734852], [-9.139523, 38.734865], [-9.139547, 38.734878], [-9.139571, 38.734891], [-9.139595, 38.734904], [-9.139619, 38.734917], [-9.139643, 38.734931], [-9.139684, 38.734925], [-9.139708, 38.734938], [-9.139732, 38.734951], [-9.139756, 38.734964], [-9.13978, 38.734977], [-9.139804, 38.73499], [-9.139828, 38.735003], [-9.139852, 38.735016], [-9.139876, 38.735029], [-9.1399, 38.735042], [-9.139924, 38.735055], [-9.139949, 38.735068], [-9.139973, 38.735081], [-9.139997, 38.735094], [-9.140021, 38.735107], [-9.140045, 38.73512], [-9.140052, 38.735152], [-9.140036, 38.735171], [-9.140019, 38.73519], [-9.140002, 38.735208], [-9.139986, 38.735227], [-9.139969, 38.735246], [-9.139953, 38.735265], [-9.139936, 38.735284], [-9.139919, 38.735302], [-9.139903, 38.735321], [-9.139886, 38.73534], [-9.13987, 38.735359], [-9.139829, 38.735364], [-9.139788, 38.73537], [-9.139748, 38.735376], [-9.139724, 38.735363], [-9.139683, 38.735369], [-9.139642, 38.735375], [-9.139602, 38.73538], [-9.139561, 38.735386], [-9.13952, 38.735392], [-9.139496, 38.735379], [-9.139456, 38.735385], [-9.139439, 38.735403], [-9.139422, 38.735422], [-9.139382, 38.735428], [-9.139358, 38.735415], [-9.139317, 38.735421], [-9.139276, 38.735426], [-9.139236, 38.735432], [-9.139212, 38.735419], [-9.139171, 38.735425], [-9.13913, 38.735431], [-9.13909, 38.735437], [-9.139066, 38.735424], [-9.139025, 38.735429], [-9.139009, 38.735448], [-9.138992, 38.735467], [-9.138975, 38.735486], [-9.138959, 38.735505], [-9.138966, 38.735536], [-9.138974, 38.735568], [-9.138981, 38.7356], [-9.138964, 38.735619], [-9.138972, 38.735651], [-9.138979, 38.735682], [-9.138987, 38.735714], [-9.138994, 38.735746], [-9.139002, 38.735778], [-9.139009, 38.73581], [-9.139017, 38.735842], [-9.139024, 38.735873], [-9.139032, 38.735905], [-9.139039, 38.735937], [-9.139046, 38.735969], [-9.139054, 38.736001], [-9.139061, 38.736032], [-9.139069, 38.736064], [-9.139076, 38.736096], [-9.139084, 38.736128], [-9.139091, 38.73616], [-9.139099, 38.736192], [-9.139106, 38.736223], [-9.139089, 38.736242], [-9.139049, 38.736248], [-9.139008, 38.736254], [-9.138992, 38.736273], [-9.138975, 38.736291], [-9.138958, 38.73631], [-9.138942, 38.736329], [-9.138949, 38.736361], [-9.138933, 38.73638], [-9.13894, 38.736411], [-9.138947, 38.736443], [-9.138955, 38.736475], [-9.138938, 38.736494], [-9.138922, 38.736513], [-9.138905, 38.736531], [-9.138913, 38.736563], [-9.138896, 38.736582], [-9.138879, 38.736601], [-9.138863, 38.73662], [-9.138846, 38.736638], [-9.13883, 38.736657], [-9.138813, 38.736676], [-9.138796, 38.736695], [-9.13878, 38.736714], [-9.138763, 38.736732], [-9.138747, 38.736751], [-9.13873, 38.73677]]

path_opt = optimize_path(path_1)
print("1:",path_1)
print("2:",path_opt)
'''